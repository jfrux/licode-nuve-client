(function(){var a=a||{};a.authors=["aalonsog@dit.upm.es","prodriguez@dit.upm.es","jcervino@dit.upm.es"],a.version=.1;var a=a||{};a.Base64=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m;for(b=-1,c=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],d=[],g=0;g<c.length;g+=1)d[c[g]]=g;return h=function(a){e=a,f=0},i=function(){var a;return e?f>=e.length?b:(a=255&e.charCodeAt(f),f+=1,a):b},j=function(a){var d,e,f,g;for(h(a),d="",e=new Array(3),f=0,g=!1;!g&&(e[0]=i())!==b;)e[1]=i(),e[2]=i(),d+=c[e[0]>>2],e[1]!==b?(d+=c[e[0]<<4&48|e[1]>>4],e[2]!==b?(d+=c[e[1]<<2&60|e[2]>>6],d+=c[63&e[2]]):(d+=c[e[1]<<2&60],d+="=",g=!0)):(d+=c[e[0]<<4&48],d+="=",d+="=",g=!0),f+=4,f>=76&&(d+="\n",f=0);return d},k=function(){if(!e)return b;for(;;){if(f>=e.length)return b;var a=e.charAt(f);if(f+=1,d[a])return d[a];if("A"===a)return 0}},l=function(a){return a=a.toString(16),1===a.length&&(a="0"+a),a="%"+a,unescape(a)},m=function(a){var c,d,e;for(h(a),c="",d=new Array(4),e=!1;!e&&(d[0]=k())!==b&&(d[1]=k())!==b;)d[2]=k(),d[3]=k(),c+=l(d[0]<<2&255|d[1]>>4),d[2]!==b?(c+=l(d[1]<<4&255|d[2]>>2),d[3]!==b?c+=l(d[2]<<6&255|d[3]):e=!0):e=!0;return c},{encodeBase64:j,decodeBase64:m}}(a);var a=a||{};a.API=function(a){"use strict";var b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r;return o={service:void 0,key:void 0,url:void 0},r=function(b,c,d){a.API.params.service=b,a.API.params.key=c,a.API.params.url=d},b=function(a,b,c,d,e){d||(d={}),p(function(a){var c=JSON.parse(a);b(c)},c,"POST",{name:a,options:d},"rooms",e)},c=function(a,b,c){p(a,b,"GET",void 0,"rooms",c)},d=function(a,b,c,d){p(b,c,"GET",void 0,"rooms/"+a,d)},e=function(a,b,c,d){p(b,c,"DELETE",void 0,"rooms/"+a,d)},f=function(a,b,c,d,e,f){p(d,e,"POST",void 0,"rooms/"+a+"/tokens",f,b,c)},g=function(a,b,c,d,e){p(c,d,"POST",{name:a,key:b},"services/",e)},h=function(a,b,c){p(a,b,"GET",void 0,"services/",c)},j=function(a,b,c,d){p(b,c,"GET",void 0,"services/"+a,d)},k=function(a,b,c,d){p(b,c,"DELETE",void 0,"services/"+a,d)},l=function(a,b,c,d){p(b,c,"GET",void 0,"rooms/"+a+"/users/",d)},m=function(a,b,c,d,e){p(c,d,"GET",void 0,"rooms/"+a+"/users/"+b,e)},n=function(a,b,c,d,e){p(c,d,"DELETE",void 0,"rooms/"+a+"/users/"+b,e)},p=function(b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,r;return void 0===g?(j=a.API.params.service,k=a.API.params.key,f=a.API.params.url+f):(j=g.service,k=g.key,f=g.url+f),""===j||""===k?void console.log("ServiceID and Key are required!!"):(l=(new Date).getTime(),m=Math.floor(99999*Math.random()),n=l+","+m,o="MAuth realm=http://marte3.dit.upm.es,mauth_signature_method=HMAC_SHA1",h&&i&&(h=formatString(h),o+=",mauth_username=",o+=h,o+=",mauth_role=",o+=i,n+=","+h+","+i),p=q(n,k),o+=",mauth_serviceid=",o+=j,o+=",mauth_cnonce=",o+=m,o+=",mauth_timestamp=",o+=l,o+=",mauth_signature=",o+=p,r=new XMLHttpRequest,r.onreadystatechange=function(){if(4===r.readyState)switch(r.status){case 100:case 200:case 201:case 202:case 203:case 204:case 205:b(r.responseText);break;case 400:void 0!==c&&c("400 Bad Request");break;case 401:void 0!==c&&c("401 Unauthorized");break;case 403:void 0!==c&&c("403 Forbidden");break;default:void 0!==c&&c(r.status+" Error"+r.responseText)}},r.open(d,f,!0),r.setRequestHeader("Authorization",o),void(void 0!==e?(r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(e))):r.send()))},q=function(b,c){var d,e,f;return d=CryptoJS.HmacSHA1(b,c),e=d.toString(CryptoJS.enc.Hex),f=a.Base64.encodeBase64(e)},formatString=function(a){var b=a.toLowerCase();non_asciis={a:"[àáâãäå]",ae:"æ",c:"ç",e:"[èéêë]",i:"[ìíîï]",n:"ñ",o:"[òóôõö]",oe:"œ",u:"[ùúûűü]",y:"[ýÿ]"};for(i in non_asciis)b=b.replace(new RegExp(non_asciis[i],"g"),i);return b},{params:o,init:r,createRoom:b,getRooms:c,getRoom:d,deleteRoom:e,createToken:f,createService:g,getServices:h,getService:j,deleteService:k,getUsers:l,getUser:m,deleteUser:n}}(a),"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:this.N=a}).call(this);